<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Numerology & Mobile Combination Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="design.css" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div id="shine"></div>
<h1>Numerology & Mobile Combination Calculator</h1>
<div class="container">
  <label for="nameInput">Enter your name</label>
  <input type="text" id="nameInput" placeholder="Your name" />
  <label for="phoneInput">Enter 10-digit phone number</label>
  <input type="text" id="phoneInput" placeholder="10-digit phone number" maxlength="10" />
  <button id="calcBtn">Calculate</button>
  <div class="result" id="output"></div>
  <div id="reducedChartBox">
    <div class="reduced-chart-label">Reduced Numbers (Strengths Chart)</div>
    <canvas id="reducedChart" width="420" height="260"></canvas>
  </div>
  <div class="download-pdf-container" id="downloadSection" style="display:none;">
    <span class="download-pdf-label">Download all meanings with PDF</span>
    <button id="downloadBtn" onclick="downloadPDF()">Download as PDF</button>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="conj.js"></script>
<script>
const values = {
  A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,
  J:1,K:2,L:3,M:4,N:5,O:6,P:7,Q:8,R:9,
  S:1,T:2,U:3,V:4,W:5,X:6,Y:7,Z:8
};
const physicalLetters = ['E','D','M','N','V','W'];
const mentalLetters = ['A','H','J','Q','S','Z'];
const emotionalLetters = ['B','C','F','K','L','O','T','X','U'];
const intuitionalLetters = ['G','I','P','R','Y'];
function getConjunctions(phone) {
  let combos = [];
  for (let i = 0; i < phone.length - 1; i++) {
    if (phone[i] !== phone[i+1]) {
      combos.push(phone[i] + phone[i+1]);
    }
  }
  return combos;
}
function reduceToSingleDigit(num){
  while(num>9 && num!==11 && num!==22 && num!==33){
    num=num.toString().split('').reduce((a,b)=>a+Number(b),0);
  }
  return num;
}
let lastConjunctions=[];
let reducedChart = null;
function calculate(){
  const name=document.getElementById('nameInput').value.toUpperCase().replace(/[^A-Z]/g,"");
  const phoneRaw=document.getElementById('phoneInput').value.replace(/[^0-9]/g,"");
  const phone=phoneRaw.replace(/0/g,"");
  const outputEl=document.getElementById('output');
  const downloadSection=document.getElementById('downloadSection');
  let total=0,physical=0,mental=0,emotional=0,intuitional=0;
  for(let char of name){
    if(values[char]){
      total+=values[char];
      if(physicalLetters.includes(char))physical+=values[char];
      if(mentalLetters.includes(char))mental+=values[char];
      if(emotionalLetters.includes(char))emotional+=values[char];
      if(intuitionalLetters.includes(char))intuitional+=values[char];
    }
  }
  let reducedValues = [
    reduceToSingleDigit(physical),
    reduceToSingleDigit(mental),
    reduceToSingleDigit(emotional),
    reduceToSingleDigit(intuitional)
  ];
  window._reducedPDFValues = reducedValues;
  let outputHtml = "";
  if(name){
    outputHtml+=`<span class="heading">NAME ANALYSIS:</span>\n`;
    outputHtml+=`Total Sum: ${total}\n`;
    outputHtml+=`Physical: ${physical}→Reduced:${reducedValues[0]}\n`;
    outputHtml+=`Mental: ${mental}→Reduced:${reducedValues[1]}\n`;
    outputHtml+=`Emotional: ${emotional}→Reduced:${reducedValues[2]}\n`;
    outputHtml+=`Intuitional: ${intuitional}→Reduced:${reducedValues[3]}\n\n`;
  }
  outputEl.innerHTML = outputHtml.replace(/\n/g,"<br>");
  const chartBox = document.getElementById("reducedChartBox");
  const chartCanvas = document.getElementById("reducedChart");
  if(name){
    chartBox.style.display = "block";
    if(reducedChart) reducedChart.destroy();
    reducedChart = new Chart(chartCanvas.getContext('2d'), {
      type: 'bar',
      data: {
        labels: ['Physical', 'Mental', 'Emotional', 'Intuitional'],
        datasets: [{
          label: "Reduced Numbers",
          data: reducedValues,
          backgroundColor: ['#feb47b', '#ff7e5f', '#43cea2', '#dad299'],
          borderWidth: 2,
          borderRadius: 13
        }]
      },
      options: {
        animation: { duration: 1040 },
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, max: 9, grid: { color: '#fcb69f80' }, stepSize:1 },
          x: { grid: { display: false } }
        }
      }
    });
  } else {
    chartBox.style.display = "none";
    if(reducedChart) reducedChart.destroy();
  }
  if(!name && !phoneRaw){
    alert("Please enter at least a name or phone number!");
    outputEl.innerHTML="";
    downloadSection.style.display="none";
    lastConjunctions=[];
    chartBox.style.display = "none";
    if(reducedChart) reducedChart.destroy();
    return;
  }
  if(phoneRaw && phoneRaw.length!==10){
    alert("Please enter a valid 10-digit phone number.");
    outputEl.innerHTML="";
    downloadSection.style.display="none";
    lastConjunctions=[];
    chartBox.style.display = "none";
    if(reducedChart) reducedChart.destroy();
    return;
  }
  if(phoneRaw){
    let phoneSum=phoneRaw.split("").reduce((a,b)=>a+Number(b),0);
    const conjunctions=getConjunctions(phone);
    lastConjunctions=conjunctions;
    let phoneHtml = "";
    phoneHtml+=`<span class="heading">PHONE ANALYSIS:</span>\n`;
    phoneHtml+=`Original: ${phoneRaw}\n`;
    phoneHtml+=`Without Zeros: ${phone}\n`;
    phoneHtml+=`Phone Sum: ${phoneSum} (Reduced: ${reduceToSingleDigit(phoneSum)})\n`;
    if(phone.length>1){
      phoneHtml+=`First Digit: ${phone[0]} (60%), Second Digit: ${phone} (40%)\n\n`;
    }
    phoneHtml+=`<span class="heading">CONJUNCTIONS:</span>\n`;
    phoneHtml+=`<span class="combos-center">${conjunctions.join(', ')}</span>\n`;
    outputEl.innerHTML = outputEl.innerHTML + phoneHtml.replace(/\n/g,"<br>");
  }else{
    lastConjunctions=[];
  }
  downloadSection.style.display=lastConjunctions.length===0?"none":"flex";
}
function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const nameRaw=document.getElementById('nameInput').value.trim();
  const userName = nameRaw.length > 0 ? nameRaw.replace(/[^\w]+/g,"_") : "Numerology";
  const filename = userName + "_analysis.pdf";
  const name = userName.toUpperCase().replace(/[^A-Z]/g,"");
  const phoneRaw = document.getElementById('phoneInput').value.replace(/[^0-9]/g,"");
  const phone = phoneRaw.replace(/0/g,"");
  const margin = 16;
  const pageWidth = doc.internal.pageSize.getWidth();
  const maxLineWidth = pageWidth - 2*margin;
  let y = margin;
  const today = new Date();
  const dateString = today.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
  const colorPrimary = [255,126,95];
  const colorAccent = [67,206,162];
  const colorHeading = [35,37,38];
  const colorSubtle = [68,68,68];
  const colorMeaning = [99,89,77];
  doc.setFont('helvetica','bold');
  doc.setFontSize(11.5);
  doc.setTextColor(...colorHeading);
  doc.text(`Report generated on ${dateString}`, pageWidth/2, y, {align:'center'});
  y+=9;
  doc.setFont('helvetica','bold');
  doc.setFontSize(20);
  doc.setTextColor(...colorPrimary);
  doc.text("Numerology & Mobile Combination Report",pageWidth/2,y,{align:'center'});
  y+=14;
  doc.setFont('helvetica','bold');
  doc.setFontSize(14);
  doc.setTextColor(...colorHeading);
  let total=0,physical=0,mental=0,emotional=0,intuitional=0;
  for(let char of name){
    if(values[char]){
      total+=values[char];
      if(physicalLetters.includes(char))physical+=values[char];
      if(mentalLetters.includes(char))mental+=values[char];
      if(emotionalLetters.includes(char))emotional+=values[char];
      if(intuitionalLetters.includes(char))intuitional+=values[char];
    }
  }
  let reducedValues = window._reducedPDFValues || [reduceToSingleDigit(physical),reduceToSingleDigit(mental),reduceToSingleDigit(emotional),reduceToSingleDigit(intuitional)];
  if(name){
    doc.text("NAME ANALYSIS",margin,y); y+=8;
    doc.setFont('helvetica','normal');
    doc.setFontSize(12);
    doc.setTextColor(...colorSubtle);
    doc.text(`Total Sum: ${total}`,margin,y); y+=7;
    doc.text(`Physical: ${physical} → Reduced: ${reducedValues[0]}`,margin,y); y+=7;
    doc.text(`Mental: ${mental} → Reduced: ${reducedValues[1]}`,margin,y); y+=7;
    doc.text(`Emotional: ${emotional} → Reduced: ${reducedValues[2]}`,margin,y); y+=7;
    doc.text(`Intuitional: ${intuitional} → Reduced: ${reducedValues[3]}`,margin,y); y+=8;
    doc.setFont('helvetica','bold');
    doc.setTextColor(...colorPrimary);
    doc.text("Reduced Numbers (By Plane):", margin, y);
    y+=8;
    doc.setFont('helvetica','normal');
    doc.setFontSize(12);
    doc.setTextColor(...colorHeading);
    const xStart = margin;
    const boxWidth = 38;
    const boxHeight = 8;
    const labelY = y;
    const valueY = y + 6;
    const labels = ['Physical', 'Mental', 'Emotional', 'Intuitional'];
    for(let i=0; i<labels.length; i++){
      doc.rect(xStart + i * boxWidth, labelY, boxWidth, boxHeight);
      doc.text(labels[i], xStart + i * boxWidth + 4, labelY + 6);
    }
    y+=boxHeight;
    for(let i=0; i<reducedValues.length; i++){
      doc.rect(xStart + i * boxWidth, y, boxWidth, boxHeight);
      doc.text(String(reducedValues[i]), xStart + i * boxWidth + 14, y + 6);
    }
    y+=boxHeight + 8;
  }
  if(phoneRaw){
    doc.setFont('helvetica','bold');
    doc.setFontSize(14);
    doc.setTextColor(...colorHeading);
    doc.text("PHONE ANALYSIS",margin,y); y+=8;
    doc.setFont('helvetica','normal');
    doc.setFontSize(12);
    doc.setTextColor(...colorSubtle);
    let phoneSum=phoneRaw.split("").reduce((a,b)=>a+Number(b),0);
    doc.text(`Original: ${phoneRaw}`,margin,y); y+=7;
    doc.text(`Without Zeros: ${phone}`,margin,y); y+=7;
    doc.text(`Phone Sum: ${phoneSum} (Reduced: ${reduceToSingleDigit(phoneSum)})`,margin,y); y+=7;
    if(phone.length>1){
      doc.text(`First Digit: ${phone[0]} (60%), Second Digit: ${phone} (40%)`,margin,y); y+=10;
    }
    let conjunctions=lastConjunctions;
    doc.setFont('helvetica','bold');
    doc.setTextColor(...colorAccent);
    doc.setFontSize(13);
    doc.text("CONJUNCTION MEANINGS",margin,y); y+=8;
    doc.setFontSize(12);
    doc.setTextColor(...colorAccent);
    doc.text(`Combinations: ${conjunctions.join(', ')}`, pageWidth/2, y, {align:'center'}); y+=10;
    doc.setFontSize(12);
    for(let pair of conjunctions){
      if(y>270){doc.addPage();y=margin;}
      doc.setFont('helvetica','bold');
      doc.setTextColor(...colorPrimary);
      doc.text(`${pair}:`,margin,y); y+=7;
      doc.setFont('helvetica','normal');
      doc.setTextColor(...colorMeaning);
      let txt=(window.comboMeanings && window.comboMeanings.hasOwnProperty(pair))?window.comboMeanings[pair]:"No data";
      let meaningLines=doc.splitTextToSize(txt,maxLineWidth-6);
      for(let l of meaningLines){
        if(y>270){doc.addPage();y=margin;}
        doc.text(l,margin+4,y);
        y+=7;
      }
      y+=2;
    }
  }
  doc.save(filename);
}
document.getElementById('calcBtn').addEventListener('click', calculate);
document.getElementById('downloadBtn').addEventListener('click', downloadPDF);
</script>
</body>
</html>
